# 金银“牛市加速段”与木火/火流年富集检验（MA-Regime + 置换检验）

---

## 1. 研究目标

验证以下命题：

- **白银（Silver）**：牛市中的“加速段（主升浪）”是否更倾向出现在**木火旺流年**。
- **黄金（Gold）**：牛市中的“加速段（主升浪）”是否更倾向出现在**火流年**。

研究强调可复制性：在多个参数组合（K、q）下检验稳健性，并采用**置换检验**（非参数）评估显著性。

---

## 2. 数据与样本

- 数据频率：月度（Month-End, ME）
- 数据源：Investing 历史月度价格（覆盖 1970s 至今）
- 研究对象：Gold、Silver
- 牛市（bull months）：通过 **MA-Regime** 识别，并将所有统计**条件化在 bull months 内**进行  
  - Gold bull months：**209**
  - Silver bull months：**162**

---

## 3. 方法与参数定义

### 3.1 牛市状态（MA-Regime）
MA-Regime 用于识别“趋势环境”（bull months），图中以阴影显示 bull 区间，用于直观核查 regime 合理性（见图 1）。

### 3.2 加速段（A_ACCEL）定义：past-K 动量加速（可交易口径）
在 bull months 内定义加速段月份（A_ACCEL）：

- 过去 \(K\) 个月累计对数涨幅：
$
score_t=\log(P_t)-\log(P_{t-K})
$
- 在 bull months 内取分位阈值 \(q\)，将 $score_t \ge \text{Quantile}_q$ 的月份定义为加速段：
  - $K \in \{6, 9, 12\}$
  - $q \in \{0.80, 0.85, 0.90, 0.95\}$
- 例如：`q=0.80` 表示取 bull months 内 **top 20%** 的 past-K 动量月份作为“加速段”。

### 3.3 八字流年标签（本研究口径）
- **白银木火旺（WoodFire-B）**：年支 ∈ {寅, 卯, 巳, 午, 未}
- **黄金火（Fire-B）**：年支 ∈ {巳, 午, 未}

> 注：当前以公历年映射流年；未采用立春切年。后续可升级节气口径。

### 3.4 置换检验（Permutation Test，单侧）
目的：检验“加速段月份”的木火/火占比是否显著高于随机情况。

- **零假设（Null）**：在 bull months 内随机抽取与加速段相同数量 \(m\) 的月份（无放回），计算木火/火占比；
- 重复抽样 \(N=5000\) 次构造零假设分布；
- 单侧 p 值：
$
p=\Pr(\text{null\_rate} \ge \text{observed\_rate})
$ 

---

## 4. 可视化结果

### 图 1：价格与牛市状态（MA-Regime）
![Fig1_GOLD_price_regime](../img/Fig1_GOLD_price_regime.png)

![Fig1_SILVER_price_regime](../img/Fig1_SILVER_price_regime.png)

### 图 2：白银加速段月份在价格路径上的位置（示例：K=9, q=0.80）
![Fig2_SILVER_accel_marks_K9_q080](../img/Fig2_SILVER_accel_marks_K9_q080.png)

### 图 4：稳健性热力图（Permutation p-value 与 uplift）
![Fig4_SILVER_heatmap_p](../img/Fig4_SILVER_heatmap_p.png)

![Fig4_SILVER_heatmap_uplift](../img/Fig4_SILVER_heatmap_uplift.png)

![Fig4_GOLD_heatmap_p](../img/Fig4_GOLD_heatmap_p.png)

![Fig4_GOLD_heatmap_uplift](../img/Fig4_GOLD_heatmap_uplift.png)

---

## 5. 核心结果（置换检验汇总表）

以下表格为本研究的主结论点与稳健性点（均为 **mode=past**，即不使用前视信息）：

| asset  | label | mode | K | q | top_pct | bull_months | subset_months | observed_% | null_mean_% | null_std_% | uplift_pp | p_perm_one_sided |
|---|---|---:|---:|---:|---:|---:|---:|---:|---:|---:|---:|---:|
| GOLD | Fire-B(支巳午未) | past | 12 | 0.80 | 20 | 209 | 42 | 50.00 | 31.93 | 6.43 | 18.07 | 0.0055989 |
| GOLD | Fire-B(支巳午未) | past | 6  | 0.80 | 20 | 209 | 42 | 47.62 | 31.93 | 6.43 | 15.69 | 0.0117976 |
| SILVER | WoodFire-B(支寅卯巳午未) | past | 9  | 0.80 | 20 | 162 | 33 | 63.64 | 38.74 | 7.68 | 24.90 | 0.0019996 |
| SILVER | WoodFire-B(支寅卯巳午未) | past | 12 | 0.85 | 15 | 162 | 25 | 64.00 | 38.69 | 8.98 | 25.31 | 0.0033993 |
| SILVER | WoodFire-B(支寅卯巳午未) | past | 12 | 0.90 | 10 | 162 | 17 | 70.59 | 38.80 | 11.09 | 31.79 | 0.0073985 |

**字段解释：**
- `bull_months`：MA-Regime 识别出的牛市月份数
- `subset_months`：A_ACCEL（加速段）月份数
- `observed_%`：加速段月份中落在目标流年标签（木火旺/火）的比例
- `null_mean_% / null_std_%`：置换零假设分布的均值与标准差（在 bull months 内随机抽取同样数量月份）
- `uplift_pp`：提升幅度（observed - null_mean，以百分点计）
- `p_perm_one_sided`：单侧置换 p 值（随机情况下出现 ≥ observed 的概率）

---

## 6. 结构性发现与解释

### 6.1 白银：加速段显著富集于木火旺流年（WoodFire-B）
在 Silver bull months（162）内，A_ACCEL 加速段在多个参数点下稳定呈现木火旺富集：
- uplift 约 **+25 至 +32 个百分点**
- 置换检验 p 值约 **0.002–0.007**（显著）

### 6.2 黄金：加速段显著富集于火流年（Fire-B）
在 Gold bull months（209）内，A_ACCEL 加速段显著偏向火流年：
- uplift 约 **+16 至 +18 个百分点**
- 置换检验 p 值约 **0.0056–0.0118**（显著）

### 6.3 资产间显著项不同，降低数据挖掘嫌疑
- Silver 显著项集中于 **木火旺（寅卯巳午未）**；
- Gold 显著项集中于 **火（巳午未）**。
显著项并非“同一标签对所有资产都显著”，体现出结构差异。

---

## 7. 对照：方案 B（牛市末段 last_12m）
此前对 “每轮牛市最后 12 个月（last_12m）” 的检验整体不显著，可作为对照（negative control）：
- 说明富集关系更像与**动量加速（主升浪）**相关，而不是与“牛市最后一年”机械绑定。

---

## 8. 局限性与后续工作

- **流年切年口径**：当前按公历年映射流年，未采用立春切年；后续可升级节气口径。
- **MA-Regime 参数敏感性**：bull months 识别依赖 MA/slope/确认/合并规则；可在邻域参数下复核稳健性。
- **多重比较**：已通过锁定主标签（Silver: WoodFire-B；Gold: Fire-B）+ 置换检验 + 热力图参数邻域一致性降低风险；后续可做更正式的多重比较校正或预注册主检验。

